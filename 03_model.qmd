---
title: "3. Model"
format: html
---

```{r}
library(here)
library(tidyr)
library(dplyr)
library(rlang)
library(glue)
library(brms)
```


```{r}
data = readRDS(here("data", "data_processed.csv"))
```

# Prior predictive checks
Setting the prior
```{r}

```

# Running models

```{r}
model1 = brm(bf(PronTypeSimple ~ Power), data = data, family = categorical(link = "logit"), chains = 1, prior = set_prior("normal(0, 5)", class = "b", dpar = "muJun"))
model2 = brm(bf(y | trials(trials) ~ Power * Intimate), data = data, family = multinomial(link = "logit"), chains = 1, prior = set_prior("normal(0,5)"))
model3 = brm(bf(y | trials(trials) ~ Power * Intimate * StanceH  + Kin), data = data, family = multinomial(link = "logit"), chains = 1, prior = set_prior("normal(0,5)"))
model4 = brm(bf(y | trials(trials) ~ Power * Intimate * StanceH + StanceS + ImpositionH + BenH + Kin), data = data, family = multinomial(link = "logit"), chains = 1, prior = set_prior("normal(0,5)"))
model5 = brm(bf(y | trials(trials) ~ Power * Intimate * StanceH * StanceS * ImpositionH * BenH * Kin), data = data, family = multinomial(link = "logit"), chains = 1, prior = set_prior("normal(0,5)"))
model6_re = brm(bf(y | trials(trials) ~ Power * Intimate + Power * StanceH + Intimate * StanceH + StanceS  + Kin + (1 | Speaker) ), data = data, family = multinomial(link = "logit"), prior = set_prior("normal(0,5)"), cores = getOption("mc.cores", 4L))
compare_waic = waic(model1, model2, model3, model4, model5, model6)
```

```{r}
model3_summ = summary(model3)
model3_fix = fixef(model3, probs = c(0.05, 0.95)) %>% data.frame
model3_fix = model3_fix %>% mutate(Coef = rownames(model3_fix))
write_csv(model3_fix, "model3fix.csv")

model4_summ = summary(model4)
model4_fix = fixef(model4, probs = c(0.05, 0.95)) %>% data.frame
model4_fix = model4_fix %>% mutate(Coef = rownames(model4_fix))
write_csv(model4_fix, "model4fix.csv")

model3_re = brm(bf(y | trials(trials) ~ Power * Intimate * StanceH  + Kin + (1 | Speaker) ), data = data, family = multinomial(link = "logit"), chains = 1)
model3_re = brm(bf(y | trials(trials) ~ Power * Intimate * StanceH  + Kin + (1 | Speaker) ), data = data, family = multinomial(link = "logit"), prior = set_prior("normal(0,5)"), cores = getOption("mc.cores", 4L))
model3_re_fix = fixef(model3_re, probs = c(0.05, 0.95)) %>% data.frame
model3_re_fix = model3_re_fix %>% mutate(Coef = rownames(model3_re_fix))
model3_re_rand = coef(model3_re, probs = c(0.05, 0.95)) %>% data.frame
model3_re_rand = model3_re_rand %>% mutate(Coef = rownames(model3_re_rand))

model3_re_fix_80 = fixef(model3_re, probs = c(0.1, 0.9)) %>% data.frame
model3_re_fix_80 = model3_re_fix_80 %>% mutate(Coef = rownames(model3_re_fix_80))
model3_re_rand_80 = coef(model3_re, probs = c(0.1, 0.90)) %>% data.frame
model3_re_rand_80 = model3_re_rand %>% mutate(Coef = rownames(model3_re_rand))

cbind(levels(data$Speaker), model3_re_rand_80[,c(1,5,9,13)]) %>% View
write_csv(model3_re_fix, "model3refix.csv")
write_csv(model3_re_rand, "model3rerand.csv")
write_csv(model3_re_fix_80, "model3refix_80.csv")
write_csv(model3_re_rand_80, "model3rerand_80.csv") 

model6_re_fix_80 = fixef(model6_re, probs = c(0.1, 0.9)) %>% data.frame
model6_re_fix_80 = model6_re_fix_80 %>% mutate(Coef = rownames(model6_re_fix_80))
```

# Posterior predictive checks